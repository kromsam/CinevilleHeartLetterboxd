<!DOCTYPE html>
<html lang="nl"> <!-- Updated the language to Dutch (nl) -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Films in Bioscopen</title> <!-- Translated the page title to Dutch -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700" rel="stylesheet"> <!-- Koppel Fira Sans-lettertype -->
    <style>
        body {
            font-family: 'Fira Sans', sans-serif; /* Specificeer het Fira Sans-lettertype */
            background-color: #f5f5f5;
            padding: 20px;
        }

        .card {
            border: 1px solid #ccc;
            margin: 10px;
            background-color: #fff;
        }

        .card img {
            max-height: 300px;
            object-fit: cover;
        }

        .card-title {
            font-size: 1.5rem;
            padding: 10px;
        }

        .card-text {
            font-size: 1.1rem;
            padding: 10px;
        }

        .list-group-item {
            font-size: 1rem;
            display: block; /* Zorg ervoor dat elk lijstitem op een nieuwe regel begint */
        }

        .showing-details {
            margin-top: 10px;
        }

        .showing {
            border: 1px solid #eee;
            padding: 10px;
            margin: 5px 0;
        }

        .showing-item {
            margin: 5px 0;
        }

        /* Style voor de weergegeven screening_info */
        .screening-info {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4 mb-4">Films in Bioscopen Bij Jou in de Buurt</h1> <!-- Bijgewerkte titel in het Nederlands -->
        <div class="row" id="filmCards"></div>
    </div>

    <script>
        // Function to group showings by date and then by theater
        function groupShowingsByDateAndTheater(showings) {
            const groupedShowings = {};
            showings.forEach(showing => {
                const date = showing.date;
                const theater = showing.location_name;
                if (!groupedShowings[date]) {
                    groupedShowings[date] = {};
                }
                if (!groupedShowings[date][theater]) {
                    groupedShowings[date][theater] = [];
                }
                groupedShowings[date][theater].push(showing);
            });
            return groupedShowings;
        }
    
        // Function to format the date to Dutch
        function formatDateToDutch(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('nl-NL', options);
        }
    
        // Function to toggle card collapse
        function toggleCardCollapse(cardId) {
            const card = document.getElementById(cardId);
            const cardCollapse = card.querySelector('.card-collapse');
            cardCollapse.classList.toggle('show');
        }
    
        // Function to get the first screening date for a film
        function getFirstScreeningDate(film) {
            const screeningDates = film.showings
                .filter(showing => showing.date)
                .map(showing => new Date(showing.date));
    
            if (screeningDates.length > 0) {
                screeningDates.sort((a, b) => a - b);
                return screeningDates[0];
            }
    
            return null;
        }
    
        // Function to get the earliest screening time for a film
        function getEarliestScreeningTime(film) {
            const times = film.showings
                .filter(showing => showing.date)
                .map(showing => showing.time_start);
    
            if (times.length > 0) {
                times.sort();
                return times[0];
            }
    
            return null;
        }
    
        // JSON data fetch
        fetch('films_with_showings.json')
            .then(response => response.json())
            .then(data => {
                const filmCards = document.getElementById('filmCards');
    
                // Sort films by their first screening date and earliest screening time
                data.sort((a, b) => {
                    const firstScreeningA = getFirstScreeningDate(a);
                    const firstScreeningB = getFirstScreeningDate(b);
    
                    if (firstScreeningA && firstScreeningB) {
                        if (firstScreeningA - firstScreeningB === 0) {
                            const earliestTimeA = getEarliestScreeningTime(a);
                            const earliestTimeB = getEarliestScreeningTime(b);
    
                            if (earliestTimeA && earliestTimeB) {
                                return earliestTimeA.localeCompare(earliestTimeB);
                            }
                        }
                        return firstScreeningA - firstScreeningB;
                    } else if (firstScreeningA) {
                        return -1;
                    } else if (firstScreeningB) {
                        return 1;
                    }
                    return 0;
                });
    
                data.forEach((film, index) => {
                    const card = document.createElement('div');
                    card.className = 'col-md-4'; // Three cards per row on medium screens
    
                    // Number of showings for the film
                    const showingCount = film.showings.length;
    
                    const showingsOrInfo = film.showings[0].date
                        ? `
                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapse-${index}">
                                Toon ${showingCount} ${showingCount === 1 ? 'Voorstelling' : 'Voorstellingen'}
                            </button>
                            <div class="collapse card-collapse" id="collapse-${index}">
                                <ul class="list-group list-group-flush">
                                    ${Object.entries(groupShowingsByDateAndTheater(film.showings)).map(([date, theaters]) => `
                                        <li class="list-group-item">
                                            <strong>${formatDateToDutch(date)}</strong>
                                            <div class="showing-details">
                                                ${Object.entries(theaters).map(([theater, showings]) => `
                                                    <div class="showing">
                                                        <strong>${theater}</strong>
                                                        ${showings.map(showing => `
                                                            <div class="showing-item">
                                                                <p>${showing.time_start} - ${showing.time_end}</p>
                                                                <a href="${showing.ticket_url}" class="btn btn-primary btn-sm" target="_blank">Koop Tickets</a>
                                                                <a href="${showing.information_url}" class="btn btn-secondary btn-sm" target="_blank">Meer Informatie</a>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `
                        : `
                            <div class="card-collapse screening-info">
                                <p>${film.showings[0].screening_info}</p>
                            </div>
                        `;
    
                    card.innerHTML = `
                        <div class="card">
                            <a href="${film.url}" target="_blank"> <!-- Koppeling naar Cineville-pagina -->
                                <img src="${film.img_url}" class="card-img-top">
                            </a>
                            <div class="card-body">
                                <h2 class="card-title">${film.title}</h2>
                                <p class="card-text">${film.oneliner}</p>
                            </div>
                            ${showingsOrInfo}
                        </div>
                    `;
                    filmCards.appendChild(card);
                });
            })
            .catch(error => console.error('Fout bij het ophalen van gegevens: ', error));
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
