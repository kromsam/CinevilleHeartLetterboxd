<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Films in Bioscopen</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,700" rel="stylesheet"> <!-- Koppeling naar Fira Sans-lettertype -->
    <style>
        body {
            font-family: 'Fira Sans', sans-serif; /* Specificeer het Fira Sans-lettertype */
            background-color: #f5f5f5;
            padding: 20px;
        }

        .card {
            border: 1px solid #ccc;
            margin: 10px;
            background-color: #fff;
        }

        .card img {
            max-height: 300px;
            object-fit: cover;
        }

        .card-title {
            font-size: 1.5rem;
            padding: 10px;
        }

        .card-text {
            font-size: 1.1rem;
            padding: 10px;
        }

        .list-group-item {
            font-size: 1rem;
            display: block; /* Zorg ervoor dat elk lijstitem op een nieuwe regel begint */
        }

        .showing-details {
            margin-top: 10px;
        }

        .showing {
            border: 1px solid #eee;
            padding: 10px;
            margin: 5px 0;
        }

        .showing-item {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4 mb-4">Films in Bioscopen bij Jou in de Buurt</h1>
        <div class="row" id="filmCards"></div>
    </div>

    <script>
        // Groepeer voorstellingen op datum en vervolgens op theater
        function groupShowingsByDateAndTheater(showings) {
            const groupedShowings = {};
            showings.forEach(showing => {
                const date = showing.date;
                const theater = showing.location_name;
                if (!groupedShowings[date]) {
                    groupedShowings[date] = {};
                }
                if (!groupedShowings[date][theater]) {
                    groupedShowings[date][theater] = [];
                }
                groupedShowings[date][theater].push(showing);
            });
            return groupedShowings;
        }

        // Datum opmaken in het Nederlands
        function formatDateToDutch(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('nl-NL', options);
        }

        // Functie om kaartinklappen in- of uit te schakelen
        function toggleCardCollapse(cardId) {
            const card = document.getElementById(cardId);
            const cardCollapse = card.querySelector('.card-collapse');
            cardCollapse.classList.toggle('show');
        }

        // JSON-gegevens ophalen
        fetch('films_with_showings.json')
            .then(response => response.json())
            .then(data => {
                const filmCards = document.getElementById('filmCards');

                data.forEach((film, index) => {
                    const card = document.createElement('div');
                    card.className = 'col-md-4'; // Drie kaarten per rij op medium schermen

                    // Tel het aantal voorstellingen voor de film
                    const showingCount = film.showings.length;

                    card.innerHTML = `
                        <div class="card">
                            <a href="${film.url}" target="_blank"> <!-- Koppeling naar Cineville-pagina -->
                                <img src="${film.img_url}" class="card-img-top">
                            </a>
                            <div class="card-body">
                                <h2 class="card-title">${film.title}</h2>
                                <p class="card-text">${film.oneliner}</p>
                            </div>
                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapse-${index}">
                                Toon ${showingCount} ${showingCount === 1 ? 'Voorstelling' : 'Voorstellingen'}
                            </button>
                            <div class="collapse card-collapse" id="collapse-${index}">
                                <ul class="list-group list-group-flush">
                                    ${Object.entries(groupShowingsByDateAndTheater(film.showings)).map(([date, theaters]) => `
                                        <li class="list-group-item">
                                            <strong>${formatDateToDutch(date)}</strong>
                                            <div class="showing-details">
                                                ${Object.entries(theaters).map(([theater, showings]) => `
                                                    <div class="showing">
                                                        <strong>${theater}</strong>
                                                        ${showings.map(showing => `
                                                            <div class="showing-item">
                                                                <p>${showing.time_start} - ${showing.time_end}</p>
                                                                <a href="${showing.ticket_url}" class="btn btn-primary btn-sm" target="_blank">Koop Tickets</a>
                                                                <a href="${showing.information_url}" class="btn btn-secondary btn-sm" target="_blank">Meer Informatie</a>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                    filmCards.appendChild(card);
                });
            })
            .catch(error => console.error('Fout bij ophalen van gegevens: ', error));
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>